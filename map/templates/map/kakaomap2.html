<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <!-- jQuery CDN 추가 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <title>Kakao 지도 시작하기</title>
</head>
<body>

<div>
    <div style="flex-direction: row; float: left">
        <div id="map" style="width: 800px; height: 500px"></div>

        <div id="lat" style="display: none">
            {% for al in alcolshops %}
                {{ al.latitude }}
            {% endfor %}
        </div>

        <div id="lng" style="display: none">
            {% for al in alcolshops %}
                {{ al.longitude }}
            {% endfor %}
        </div>

        <div id="name" style="display: none">
            {% for al in alcolshops %}
                {{ al.name }}
            {% endfor %}
        </div>

    </div>
    <div>
        <form method="POST" action="{% url 'map:kakaomap' %}">
            {% csrf_token %}
            <p><label for="id_patner">patner:</label>
                <input type="checkbox" name="patner" id="id_patner">
            </p>
            <p><label for="id_store">store:</label>
                <input type="checkbox" name="store" id="id_store">
            </p>
            <button type="submit">search</button>
        </form>
    </div>
<div>
    <button id="submit_btn" type="submit"></button>
</div>
</div>

<script type="text/javascript"
        src="//dapi.kakao.com/v2/maps/sdk.js?appkey=f5318beaf9fa32376898cdd9405db0e2&libraries=services,clusterer,drawing"></script>
<script>
    // 마커를 담을 배열
    let markers: any[] = [];

    const container = document.getElementById("map")
    const options = {
        center: new window.kakao.maps.LatLng(38.2313466, 128.2139293),
        level: 1,
    };
    // 지도를 생성한다.
    const map = new window.kakao.maps.Map(container, options);

    // markerPosition이라는 변수에 마커의 위치를 담습니다.
    const markerPosition = new window.kakao.maps.LatLng(
        38.2313466,
        128.2139293
    );
    // marker라는 변수를 이용해서 위치를 markerPosition의 위치로 지정한다음
    const marker = new window.kakao.maps.Marker({
        position: markerPosition,
    });
    // marker.setMap(map) 이라는 메서드를 통해서 map에 생성합니다.
    marker.setMap(map);

    //검색 객체와 검색 결과 목록이나 마커를 클릭시 장소명을 표출할 인포 윈도우 생성

    // ps를 이용해 장소 검색 객체를 담습니다. 카카오 자체에서 제공되는 메서드를 이용합니다.
    const ps = new window.kakao.maps.services.Places();
    // infowindow라는 변수에 InfoWindow를 만들어 줍니다.
    const infowindow = new window.kakao.maps.InfoWindow({ zIndex: 1 });

    // kakao 제공 키워드로 장소를 검색합니다.
    // 내가 적용한 것
    const searchForm = document.getElementById("submit_btn");
    searchForm?.addEventListener("click", function (e) {
        e.preventDefault();
        searchPlaces();
    });

    function searchPlaces() {
        const keyword = document.getElementById("keyword").value;

        if (!keyword.replace(/^\s+|\s+$/g, "")) {
            alert("키워드를 입력해주세요!");

            return false;
        }

        ps.keywordSearch(keyword, placesSearchCB);

    }

</script>
</body>
</html>